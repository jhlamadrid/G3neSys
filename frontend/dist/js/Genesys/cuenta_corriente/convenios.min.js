$('#convenios').DataTable({bFilter: true, ordering: false,bInfo: false,lengthMenu: [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]});
/*
**************************************************************************************
*                                                                                    *
*                    FUNCIÓN PARA CARGAR EL MODAL DE LOADING                         *
*       ---------------------------------------------------------------------        *
*     ->  Inicializar el modal de cargando y aplciar el css respectico               *
*                                                                                    *
**************************************************************************************
*/
var waitingDialog = waitingDialog || (function ($) { 'use strict';
var $dialog = $('<div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;"><div class="modal-dialog modal-m"><div class="modal-content" style="border-radius:5px">' +
    '<div class="modal-header"><h3 style="margin:0;font-family:\'Ubuntu\'"></h3></div><div class="modal-body"><div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div></div></div></div></div>');
  return { show: function (message, options) { if (typeof options === 'undefined') options = {}; if (typeof message === 'undefined') message = 'Cargando Recibos'; var settings = $.extend({ dialogSize: 'm', progressType: '', onHide: null  }, options);$dialog.find('.modal-dialog').attr('class', 'modal-dialog').addClass('modal-' + settings.dialogSize);$dialog.find('.progress-bar').attr('class', 'progress-bar');
    if (settings.progressType) $dialog.find('.progress-bar').addClass('progress-bar-' + settings.progressType); $dialog.find('h3').text(message);
    if (typeof settings.onHide === 'function') { $dialog.off('hidden.bs.modal').on('hidden.bs.modal', function (e) { settings.onHide.call($dialog); }); } $dialog.modal();},hide: function () { $dialog.modal('hide'); }
};})(jQuery);
/*
**************************************************************************************
*                                                                                    *
*                FUNCIÓN PARA VISUALIZAR LAS LETRAS DEL CONVENIO                     *
*       ---------------------------------------------------------------------        *
*     ->  Carga un modal con la deuda de sus letras que tiene el convenio.           *
*                                                                                    *
**************************************************************************************
*/
function ver_detalle_convenido(oficina,agencia,credito){
    waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
    $.ajax({
        type : 'POST',
        url : servidor + "cuenta_corriente/detalle_convenio?ajax=true",
        data : ({
            oficina :  oficina,
            agencia :  agencia,
            credito : credito,
            suministro :  suministro
        }),
        cache :  false,
        dataType : 'json',
        success : function(resultado){
            if(resultado.result){
                $('#cuotas').dataTable().fnDestroy();
                $("#cabecerra_detalle_convenio").empty();
                $("#cabecerra_detalle_convenio").append(resultado.cabecera);
                $("#cuerpo_letras").empty();
                $("#cuerpo_letras").append(resultado.detalle);
                $('#cuotas').DataTable({bFilter: true, ordering: false,bInfo: false,lengthMenu: [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]});
                waitingDialog.hide();
                $("#detalle_convenio").modal({backdrop: 'static', keyboard: false, show:"show"});
            } else {
                waitingDialog.hide();
                swal({title : '',text : resultado.mensaje, type : 'warning',html : true});
            }
        }, error : function(jqXHR, textStatus, errorThrown){
            _error(jqXHR,textStatus,errorThrown);
        }
    });
}
/*
**************************************************************************************
*                                                                                    *
*            FUNCIÓN PARA TRATAR EL ERROR QUE SE OBTIENE DEL SERVIDOR                *
*       ---------------------------------------------------------------------        *
*     ->  Captura el error del servidor y de acuerdo al tipo de error muestra        *
*         un mensaje al usuario, para su tratameinto                                 *
*                                                                                    *
**************************************************************************************
*/
function _error(jqXHR,textStatus,errorThrown){
    waitingDialog.hide(); 
    if (jqXHR.status === 0)  swal({title : "",text : "<b>ERROR</b><br>VERIFIQUE SU CONEXIÓN A INTERNET",type : "error", html : true});
    else if (jqXHR.status == 404)  swal({title : "",text : "<b>ERROR</b><br>EL RECURSO SOLICITADO NO SE PUEDE ENCONTRAR, PERO PUEDE ESTAR DISPONIBLE EN EL FUTURO",type : "error" ,html : true});
    else if (jqXHR.status == 500) swal({title : "",text : "<b>ERROR</b><br>ERROR INTERNO DEL SERVIDOR",type : "error", html : true});
    else if (textStatus === 'parsererror') swal({'title' : "",'text' : "ERROR EN LA CONSULTA",'type' : "error",html : true});
    else if (textStatus === 'timeout') swal({title : "",text : "<b>ERROR</b><br>ERROR EN EL TIEMPO DE CONEXIÓN",type : "error", html : true});
    else if (textStatus === 'abort') swal({'title' : "",'text' : "PETICIÓN CANCELADA",'type' : "error"});
    else  swal({title : "", text : "<b>ERROR </b><br>ERROR DESCONOCIDO: "+jqXHR.responseText, type : "error", html : true});
}
/*
**************************************************************************************
*                                                                                    *
*            FUNCIÓN PARA MOSTRAR LOS CONVENIOS DE LA CUENTA 939 - 940               *
*       ---------------------------------------------------------------------        *
*     ->  Carga los convenios de la cuenta corriente 939 y 940.                      *
*                                                                                    *
**************************************************************************************
*/
$("#cta_939_940").change(function() { 
    $('#convenios').dataTable().fnDestroy();
    $("#cuerpo_convenios").empty();
    var cuerpo = "";
    if(this.checked) { 
        for(var i = 0;i < convenios939_940.length; i++){ 
            cuerpo += '<tr>'+
                        '<td class="derecha">'+convenios939_940[i]['AGENCI_OFICIN_OFICOD']+'</td>'+
                        '<td class="derecha">'+convenios939_940[i]['AGENCI_OFIAGECOD']+'</td>'+
                        '<td>'+convenios939_940[i]['CREDNRO']+'</td>'+
                        '<td>'+convenios939_940[i]['CREDFECHA']+'</td>'+
                        '<td class="derecha">'+parseFloat(convenios939_940[i]['DEUDATOTAL']).toFixed(2)+'</td>'+
                        '<td class="derecha">'+parseFloat(convenios939_940[i]['CTAINICIAL']).toFixed(2)+'</td>'+
                        '<td>'+convenios939_940[i]['CREDSTATUS']+'</td>'+
                        '<td class="derecha">'+convenios939_940[i]['CONCEP_FACCONCOD']+'</td>'+
                        '<td>'+convenios939_940[i]['FACCONDES']+'</td>';bandera = 0;
                for(var j = 0; j < convenios_pendientes.length; j++){ 
                    if(convenios939_940[i]['CREDNRO'] == convenios_pendientes[j]['CREDNRO']){ bandera = 1; break; }
                }
                if(bandera == 1) cuerpo += '<td class="derecha text-red">'+(parseFloat(convenios939_940[i]['DEUDATOTAL']) - parseFloat(convenios939_940[i]['CTAINICIAL'])).toFixed(2)+'</td>';
                else cuerpo += '<td class="derecha">'+(parseFloat(convenios939_940[i]['DEUDATOTAL']) - parseFloat(convenios939_940[i]['CTAINICIAL'])).toFixed(2)+'</td>';
                cuerpo +=   '<td>'+convenios939_940[i]['NNOMBRE']+'</td>'+
                            '<td style="text-align:center;vertical-align:middle">'+
                                '<div class="dropdown drop">'+
                                    '<button class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">'+
                                        '<i class="fa fa-filter" aria-hidden="true"></i> Opciones<span class="caret"></span>'+
                                    '</button>'+
                                    '<ul class="dropdown-menu dropdown-menu-right bg_color">';
                if(detalle_convenio){
                    cuerpo +=  '<li>'+
                                '<a onclick="ver_detalle_convenido(\''+convenios939_940[i]['AGENCI_OFICIN_OFICOD']+'\',\''+convenios939_940[i]['AGENCI_OFIAGECOD']+'\',\''+convenios939_940[i]['CREDNRO']+'\')" class="hover_yellow">'+
                                '<i class="fa fa-eye" aria-hidden="true"></i> DETALLE CONVENIO'+
                                '</a></li>';
                }
                if(imprimir_convenio){
                    cuerpo += '<li  class="divider"></li>'+
                              '<li>'+
                                '<a onclick="imprimir_convenio(\''+convenios939_940[i]['AGENCI_OFICIN_OFICOD']+'\',\''+convenios939_940[i]['AGENCI_OFIAGECOD']+'\',\''+convenios939_940[i]['CREDNRO']+'\')" class="hover_yellow">'+
                                '<i class="fa fa-print" aria-hidden="true"></i> IMPRIMIR CONVENIO'+
                               '</a></li>';
                }
                cuerpo += "</ul></div></td>";
              }
              $("#cuerpo_convenios").append(cuerpo); $('#convenios').DataTable({bFilter: true, "ordering": false,bInfo: false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]],});
  } else { 
      for(var i = 0;i < convenios.length; i++){ 
          cuerpo += '<tr><td class="derecha">'+convenios[i]['AGENCI_OFICIN_OFICOD']+'</td>'+
                        '<td class="derecha">'+convenios[i]['AGENCI_OFIAGECOD']+'</td>'+
                        '<td>'+convenios[i]['CREDNRO']+'</td>'+
                        '<td>'+convenios[i]['CREDFECHA']+'</td>'+
                        '<td class="derecha">'+parseFloat(convenios[i]['DEUDATOTAL']).toFixed(2)+'</td>'+
                        '<td class="derecha">'+parseFloat(convenios[i]['CTAINICIAL']).toFixed(2)+'</td>'+
                        '<td>'+convenios[i]['CREDSTATUS']+'</td>'+
                        '<td class="derecha">'+convenios[i]['CONCEP_FACCONCOD']+'</td>'+
                        '<td>'+convenios[i]['FACCONDES']+'</td>';bandera = 0;
          for(var j = 0; j < convenios_pendientes.length; j++){  if(convenios[i]['CREDNRO'] == convenios_pendientes[j]['CREDNRO']){ bandera = 1; break; }}
          if(bandera == 1) cuerpo += '<td class="derecha text-red">'+(parseFloat(convenios[i]['DEUDATOTAL']) - parseFloat(convenios[i]['CTAINICIAL'])).toFixed(2)+'</td>';
          else cuerpo += '<td class="derecha">'+(parseFloat(convenios[i]['DEUDATOTAL']) - parseFloat(convenios[i]['CTAINICIAL'])).toFixed(2)+'</td>';
           cuerpo +=   '<td>'+convenios[i]['NNOMBRE']+'</td>'+
                            '<td style="text-align:center;vertical-align:middle">'+
                                '<div class="dropdown drop">'+
                                    '<button class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">'+
                                        '<i class="fa fa-filter" aria-hidden="true"></i> Opciones<span class="caret"></span>'+
                                    '</button>'+
                                    '<ul class="dropdown-menu dropdown-menu-right bg_color">';
          if(detalle_convenio){
                cuerpo +=  '<li>'+
                           '<a onclick="ver_detalle_convenido(\''+convenios[i]['AGENCI_OFICIN_OFICOD']+'\',\''+convenios[i]['AGENCI_OFIAGECOD']+'\',\''+convenios[i]['CREDNRO']+'\')" class="hover_yellow">'+
                            '<i class="fa fa-eye" aria-hidden="true"></i> DETALLE CONVENIO'+
                            '</a></li>';
          }
          if(imprimir_convenio){
               cuerpo += '<li  class="divider"></li>'+
                          '<li>'+
                          '<a onclick="imprimir_convenio(\''+convenios[i]['AGENCI_OFICIN_OFICOD']+'\',\''+convenios[i]['AGENCI_OFIAGECOD']+'\',\''+convenios[i]['CREDNRO']+'\')" class="hover_yellow">'+
                         '<i class="fa fa-print" aria-hidden="true"></i> IMPRIMIR CONVENIO'+
                         '</a></li>';
          }
          cuerpo += "</ul></div></td>";
        } $("#cuerpo_convenios").append(cuerpo); $('#convenios').DataTable({bFilter: true, "ordering": false,bInfo: false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]],});
}});

function imprimir_convenio(oficina,agencia,credito){ 
    var myWindow = window.open(servidor+"cuenta_corriente/imprimir_credito/"+suministro+"/"+oficina+"/"+agencia+"/"+credito, "_blank"); 
    myWindow.focus();
    myWindow.print();
}
/*
**************************************************************************************
*                                                                                    *
*                 FUNCIÓN PARA ACOMODAR LO QUE DESACOMODA EL MODAL                   *
*              -----------------------------------------------------                 *
*     -> Vuelve a la posición inicial el body despues de renderizar el modal         *
*                                                                                    *
**************************************************************************************
*/
function ocultar_modal (id) {
    $("#"+id).modal('hide');
    setTimeout(function(){ 
      $('body').css("padding-right","0px") 
    }, 600)
  }