var fecha_final = "";
$('#recibos_pendientes').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]});
$("#deuda_90_91").change(function() { if(this.checked){
    waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
    $.ajax({  type : "POST", url : servidor+"cuenta_corriente/obtener_recibos_serie_90_91?ajax=true",  data : ({ suministro : suministro }),cache : false, dataType  : 'json',
    success : function(resultado){ waitingDialog.hide(); if(resultado.result){ $("#lista_serie_90_91").dataTable().fnDestroy(); $("#cuerpo_serie_90_91").empty(); $("#cuerpo_serie_90_91").append(resultado.recibos); $('#lista_serie_90_91').DataTable({ bInfo: false,ordering: false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]}); $("#serie_90_91").modal({backdrop: 'static', keyboard: false, show:"show"});
    } else { swal({title : "",text : resultado.mensaje, type: "warning",html :true}); }
    }, error : function(jqXHR,textStatus,errorThrown){ _error(jqXHR,textStatus,errorThrown);}});} });
$("#notas_recibos").change(function() { if(this.checked){ 
    waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
    $.ajax({ type : "POST", url : servidor+"cuenta_corriente/recibos_anulados?ajax=true",  data : ({ suministro : suministro1 }),cache : false, dataType  : 'json',
    success : function(resultado){ waitingDialog.hide(); if(resultado.result){ $("#lista_recibos_descontados").dataTable().fnDestroy(); $("#cuerpo_recibos_descontados").empty(); $("#cuerpo_recibos_descontados").append(resultado.recibos); $('#lista_recibos_descontados').DataTable({ bInfo: false,ordering: false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]}); $("#recibos_descontados").modal({backdrop: 'static', keyboard: false, show:"show"});
    } else { swal({title : "",text : resultado.mensaje, type: "warning",html :true}); }
    }, error : function(jqXHR,textStatus,errorThrown){ _error(jqXHR,textStatus,errorThrown); } });} });
function _error(jqXHR,textStatus,errorThrown){waitingDialog.hide(); 
    if (jqXHR.status === 0)  swal({title : "",text : "<b>ERROR</b><br>VERIFIQUE SU CONEXIÓN A INTERNET",type : "error", html : true});
    else if (jqXHR.status == 404) swal({title : "",text : "<b>ERROR</b><br>EL RECURSO SOLICITADO NO SE PUEDE ENCONTRAR, PERO PUEDE ESTAR DISPONIBLE EN EL FUTURO",type : "error" ,html : true});
    else if (jqXHR.status == 500) swal({title : "",text : "<b>ERROR</b><br>ERROR INTERNO DEL SERVIDOR",type : "error", html : true});
    else if (textStatus === 'parsererror') swal({'title' : "",'text' : "ERROR EN LA CONSULTA",'type' : "error",html : true});
    else if (textStatus === 'timeout') swal({title : "",text : "<b>ERROR</b><br>ERROR EN EL TIEMPO DE CONEXIÓN",type : "error", html : true});
    else if (textStatus === 'abort') swal({'title' : "",'text' : "PETICIÓN CANCELADA",'type' : "error"});
    else swal({title : "", text : "<b>ERROR </b><br>ERROR DESCONOCIDO: "+jqXHR.responseText, type : "error", html : true});
  }
var waitingDialog = waitingDialog || (function ($) { 'use strict';
var $dialog = $('<div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;"><div class="modal-dialog modal-m"><div class="modal-content" style="border-radius:5px">' +
    '<div class="modal-header"><h3 style="margin:0;font-family:\'Ubuntu\'"></h3></div><div class="modal-body"><div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div></div></div></div></div>');
  return { show: function (message, options) { if (typeof options === 'undefined') options = {}; if (typeof message === 'undefined') message = 'Cargando Recibos'; var settings = $.extend({ dialogSize: 'm', progressType: '', onHide: null  }, options);$dialog.find('.modal-dialog').attr('class', 'modal-dialog').addClass('modal-' + settings.dialogSize);$dialog.find('.progress-bar').attr('class', 'progress-bar');
    if (settings.progressType) $dialog.find('.progress-bar').addClass('progress-bar-' + settings.progressType); $dialog.find('h3').text(message);
    if (typeof settings.onHide === 'function') { $dialog.off('hidden.bs.modal').on('hidden.bs.modal', function (e) { settings.onHide.call($dialog); }); } $dialog.modal();},hide: function () { $dialog.modal('hide'); }
};})(jQuery);
function ver_cambios_catastrales(suministro){
    waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
    $.ajax({  type : "POST", url : servidor+"cuenta_corriente/cambios_catastrales?ajax=true",  data : ({ suministro : suministro }), cache : false,  dataType  : 'json',success : function(resultado){ if(resultado.result){ $("#cambios_catastrales_cuerpo").dataTable().fnDestroy(); $("#camcat_cuerpo").empty(); $("#camcat_cuerpo").append(resultado.cambios); $('#cambios_catastrales_cuerpo').DataTable({ bInfo: false,ordering: false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]}); waitingDialog.hide(); $("#cambios_catastrales").modal({backdrop: 'static', keyboard: false, show:"show"});
    } else { waitingDialog.hide(); swal({title : "",text : resultado.mensaje, type: "warning",html :true}); }
    }, error : function(jqXHR,textStatus,errorThrown){ _error(jqXHR,textStatus,errorThrown);} });}
function ver_detalle (serie,numero) {  
    waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
    $.ajax({ type : "POST", url : servidor+"cuenta_corriente/obtener_detalle_recibo?ajax=true", data : ({ suministro : suministro, serie : serie,numero : numero}), cache : false, dataType  : 'json',
    success : function(resultado){  waitingDialog.hide(); if(resultado.result){ $("#cabecera_detalle_recibo").empty(); $("#serie_numero_recibo").empty(); $("#cuerpo_detalle_recibo").empty(); $("#cuerpo_detalle_recibo").append(resultado.cuerpo);
    $("#serie_numero_recibo").append(resultado.ser_nro); $("#cabecera_detalle_recibo").append(resultado.cabecera); $("#detalle_recibo").modal({backdrop: 'static', keyboard: false, show:"show"});
    } else {  swal({title : "",text : resultado.mensaje, type: "warning",html :true});}
    }, error : function(jqXHR,textStatus,errorThrown){ _error(jqXHR,textStatus,errorThrown); } }); }
function ver_pagos(_suministro) {
    waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
    $.ajax({ type : 'POST', url : servidor+'cuenta_corriente/buscar_pagos?ajax=true', data : ({suministro : _suministro}),cache : false, dataType : 'json', success : function(data){ waitingDialog.hide();  if(data.result){
    window.open(servidor+"cuenta_corriente/ver_pagos/"+_suministro, "_blank"); } else { swal({'title': "",'text' : data.mensaje, 'type':"warning",'html' : true }); }
    }, error :  function(jqXHR, textStatus, errorThrown){ _error(jqXHR,textStatus,errorThrown); } });}
function ver_estados_catastrales (suministro){ 
  waitingDialog.show("Cargando Información...",{dialogSize: 'lg' , progressType: 'warning'});
  $.ajax({ 
    type : 'POST', 
    url  : servidor+'cuenta_corriente/estados_catastrales?ajax=true', 
    data : ({suministro : suministro}),  cache : false,  dataType : 'json', success : function(resultado){ 
  if(resultado.result){ $("#estado_cliente").val(resultado.estado.DESESCLTE); $("#tipo_servicio").val(resultado.estado.DESTIPSER); $("#conexion_agua").val(resultado.estado.CONESTDES); $("#conexion_desague").val(resultado.estado.CONDESDES); $("#est_cat_medidor").val( resultado.medidor); $("#est_cat_localidad").val(resultado.localidad); $("#estados_catastrales").modal({backdrop: 'static', keyboard: false, show:"show"}); waitingDialog.hide();
  } else {  waitingDialog.hide(); swal({ title : "", text : resultado.mensaje , type : "warning", html : true }); }
  }, error: function(jqXHR , textStatus, errorThrown){  _error(jqXHR , textStatus, errorThrown); } });}
function ampliar_cortes(suministro){
  waitingDialog.show("Cargando Información...",{dialogSize: 'lg' , progressType: 'warning'});
  $.ajax({ type : 'POST', url  : servidor+'cuenta_corriente/ampliacion_cortes?ajax=true', data : ({suministro : suministro}), cache : false, dataType : 'json', success : function(resultado){ waitingDialog.hide();
  if(resultado.result){ $("#lista_recibos").dataTable().fnDestroy();$("#numero_recibo").val("");$("#emision_recibo").val("");$("#vencimiento_recibo").val("");$("#glosa_plazo").val("");$("#fecha_plazo").prop('disabled',true);$("#glosa_plazo").prop('disabled',true);$("#btn_ampliacion").attr("onclick","");
  $("#btn_ampliacion").attr("disabled",true);$("#cuerpo_recibos_pendientes").empty();$("#cuerpo_ampliaciones").empty();$("#cuerpo_recibos_pendientes").append(resultado.recibos);$('#lista_recibos').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[5, 10, 15, 20, -1],[5, 10, 15, 20, "Todos"]]});$("#ampliaciones_cortes").modal({backdrop: 'static', keyboard: false,  show :"show" });
  } else { swal({title : "",text : resultado.mensaje, type : "warning" , html : true}); }
  }, error: function(jqXHR , textStatus, errorThrown){ _error(jqXHR , textStatus, errorThrown);}});}
function ver_ampliaciones(_suministro){
  waitingDialog.show("Cargando Información...",{dialogSize: 'lg' , progressType: 'warning'});
  $.ajax({ type : 'POST', url  : servidor+'cuenta_corriente/view_ampliaciones?ajax=true', data : ({suministro : _suministro}), cache : false, dataType : 'json', success : function(resultado){ waitingDialog.hide();
  if(resultado.result){ $("#ampliaciones_lista").dataTable().fnDestroy(); $("#cuerpo_ampliaciones").append(resultado.ampliaciones); $('#ampliaciones_lista').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[5, 10, 15, 20, -1],[5, 10, 15, 20, "Todos"]]}); $("#ampliaciones").modal({backdrop: 'static', keyboard: false,  show :"show" });
  } else {swal({title : '',text : resultado.mensaje, type: 'warning', html :true}); } },
  error : function(jqXHR , textStatus, errorThrown){ _error(jqXHR , textStatus, errorThrown);}});}
function ampliar($serie,$numero,$emision,$vencimiento){ $("#numero_recibo").val($serie+" - "+$numero); $("#emision_recibo").val($emision); $("#vencimiento_recibo").val($vencimiento); $("#glosa_plazo").val(""); $("#fecha_plazo").prop('disabled',false); $("#glosa_plazo").prop('disabled',false);fecha_final = $vencimiento; $("#btn_ampliacion").attr("onclick","guardar_ampliacion()"); $("#btn_ampliacion").attr("disabled",false);}
function ocultar_modal (id) { $("#"+id).modal('hide'); setTimeout(function(){  $('.sidebar-mini').css("padding-right","0px"); }, 600);}
function ver_faturacion (suministro) {
  waitingDialog.show("Cargando Información...",{dialogSize: 'lg' , progressType: 'warning'});
  $.ajax({ type : 'POST',  url  : servidor+'cuenta_corriente/get_pediodo_facturacion?ajax=true', data : ({suministro : suministro}), cache : false,dataType : 'json',success : function(resultado){
  if(resultado.result){var periodo1 =  resultado.fecha.slice(-4) + "-" + resultado.fecha.substr(3,2);var periodo =  resultado.fech.slice(-4) + "-" + resultado.fech.substr(3,2);var mes = parseInt(resultado.fech.substr(3,2));var anio = parseInt(resultado.fech.slice(-4));$("#facturacion_periodos_inicio").empty();
  $("#facturacion_periodos_fin").empty();$("#facturacion_periodos_inicio").append("<option value='-1'>Selecciones una opción </option>");$("#facturacion_periodos_fin").append("<option value='-1'>Selecciones una opción </option>");
  while(periodo1 != periodo){if(mes < 13){ $("#facturacion_periodos_inicio").append("<option value='"+anio+((mes<10) ? "0"+mes : mes)+"'>"+anio+"-"+((mes < 10 ) ? "0"+mes : mes)+"</option>"); 
  $("#facturacion_periodos_fin").append("<option value='"+anio+((mes<10) ? "0"+mes : mes)+"'>"+anio+"-"+((mes < 10 ) ? "0"+mes : mes)+"</option>");periodo = anio+"-"+((mes < 10) ? "0"+mes : mes);mes++; } else {anio ++;mes = 1;} } 
  $("#faturacion_suministro").val(suministro); waitingDialog.hide();$("#facturacion_suministro").modal({backdrop: 'static', keyboard: false, show : "show"});
  } else {waitingDialog.hide();swal({title : '',text : resultado.mensaje, type: 'warning', html :true});}
  }, error : function(jqXHR , textStatus, errorThrown){ _error(jqXHR , textStatus, errorThrown); }});}
function detalle_nota (suministro,serie,nro){ 
  waitingDialog.show("Cargando Información...",{dialogSize: 'lg' , progressType: 'warning'});
  $.ajax({ type: 'POST', url: servidor+'cuenta_corriente/ver_detalle_nota?ajax=true',data: ({ 'suministro' : suministro, 'serie' : serie, 'nro' : nro }), cache: false, dataType: 'json',success: function(resultado){ waitingDialog.hide(); 
  if(resultado.result){ $("#serie_numero").html(resultado.nca.NCASERNRO+"-"+resultado.nca.NCANRO);$("#detalle_nca_fecha").val(resultado.nca.NCAFECHA);$("#detalle_nca_referencia").val(resultado.nca.NCAREFE);
    $("#detalle_nca_usuario").val(resultado.usuario); $("#cuerpo_detalle").empty();$("#cuerpo_detalle").append(resultado.nota);$("#modal_nota_credito").modal({backdrop: 'static', keyboard: false,  show :"show" });
  } else { swal({title : '',text : resultado.mensaje, type: 'warning', html :true});}
  }, error: function(jqXHR,textStatus,errorThrown){ _error(jqXHR,textStatus,errorThrown); } });}
function ver_unidades(_grupo,_subgrupo){
  waitingDialog.show('Cargando unidades...', {dialogSize: 'lg', progressType: 'warning'});
  $.ajax({type : 'POST',url : servidor+'cuenta_corriente/get_unidades?ajax=true',data : ({ grupo : _grupo,subgrupo : _subgrupo}),cache : false,dataType : 'json',success :  function(data){waitingDialog.hide(); if(data.result) {$("#lista_unidades").dataTable().fnDestroy();$("#cuerpo_unidades").empty();$("#cuerpo_unidades").append(data.unidades);$('#lista_unidades').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]});$("#unidades").modal({backdrop: 'static', keyboard: false, show : 'show'})
  } else {swal({title : '',text : data.mensaje,type:'warning',html:true });}
  }, error : function(jqXHR,textStatus,errorThrown){_error(jqXHR,textStatus,errorThrown);}});}
function get_anulaciones(_suministro){
  waitingDialog.show('Cargando Notas de Crédito Anuladas...', {dialogSize: 'lg', progressType: 'warning'});
  $.ajax({type : 'POST',url : servidor+'cuenta_corriente/get_anulaciones?ajax=true',data : ({suministro : _suministro}),cache : false,dataType : 'json',
  success : function(data){waitingDialog.hide();if(data.result){$("#notas_credito").dataTable().fnDestroy();$("#cuerpo_anulaciones").empty();$("#cuerpo_anulaciones").append(data.anulaciones);$('#notas_credito').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]});$("#anulaciones").modal({backdrop: 'static', keyboard: false, show : 'show'});
  } else {swal({title : '',text : data.mensaje,type:'warning',html:true });}
  }, error :  function(jqXHR,textStatus,errorThrown){_error(jqXHR,textStatus,errorThrown);}});}
function ver_recibos_autorizaciones(_suministro){
  waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
  $.ajax({type : "POST",url : servidor+"cuenta_corriente/buscar_autorizaciones?ajax=true",data : ({suministro :  _suministro}),cache :  false,dataType : 'json',success : function(data){
  if(data.result){$("#cuerpo_autorizaciones").empty("");$("#cuerpo_autorizaciones").append(data.autorizaciones);$("#autorizaciones").modal({backdrop: 'static', keyboard: false, show : 'show'});waitingDialog.hide();
  } else {waitingDialog.hide();swal({title : "",text : data.mensaje,type: "warning",html:true});}
  }, error : function(jqXHR,textStatus,errorThrown){ _error(jqXHR,textStatus,errorThrown);} });}
function imprimir_pagos(key){var myWindow = window.open(servidor+"cuenta_corriente/imprimir_pagos/"+key, "_blank");myWindow.document.title = "PAGOS " + suministro;myWindow.focus();myWindow.print();}
function imprimir_rangos(suministro){
  waitingDialog.show("Cargando Información...",{dialogSize: 'lg' , progressType: 'warning'});
  $.ajax({  type: 'POST', url: servidor+'cuenta_corriente/obtener_rangos?ajax=true', data: ({ 'suministro' : suministro }), cache: false, dataType: 'json',success: function(resultado){ waitingDialog.hide(); 
  if(resultado.result){ var periodo =  resultado.fecha.slice(-4) + "-" + resultado.fecha.substr(3,2);var periodo1 =  resultado.fin.slice(-4) + "-" + resultado.fin.substr(3,2);var mes = parseInt(resultado.fecha.substr(3,2));var anio = parseInt(resultado.fecha.slice(-4));$("#rango_inicio").empty();$("#rango_fin").empty();
  $("#rango_inicio").append("<option value='-1'>Selecciones una opción </option>");$("#rango_fin").append("<option value='0'>Selecciones una opción </option>");
  while(periodo1 != periodo){if(mes < 13){ $("#rango_inicio").append("<option value='"+anio+((mes<10) ? "0"+mes : mes)+"'>"+anio+"-"+((mes < 10 ) ? "0"+mes : mes)+"</option>"); $("#rango_fin").append("<option value='"+anio+((mes<10) ? "0"+mes : mes)+"'>"+anio+"-"+((mes < 10 ) ? "0"+mes : mes)+"</option>");periodo = anio+"-"+((mes < 10) ? "0"+mes : mes);mes++;
  } else {anio ++;mes = 1;}} $("#rango_suministro").val(suministro);$("#rangos_pagos").modal({backdrop: 'static', keyboard: false,  show :"show" });} else {swal({title : '',text : resultado.mensaje, type: 'warning', html :true});}
  }, error: function(jqHXR,textSuccess,errorThrown){ _error(jqHXR,textSuccess,errorThrown);}});}
function validar_segundo_pediodo_rangos(){var min = $("#rango_inicio").val(); $("#rango_fin").attr('disabled',false); var minusage = parseInt(min); var select = $('#rango_fin'); select.val($('option:first', select).val());$("#rango_fin option").each(function(){
    if(minusage >= parseInt($(this).val()) && parseInt($(this).val()) != -1){ $(this).attr('disabled','disabled'); } else { $(this).attr('disabled',false);}});}
$("#btn_visualizar").click(function(){if($("#rango_inicio").val() != -1){myWindow = window.open(servidor+"cuenta_corriente/imprimir_rangos/"+$("#rango_suministro").val()+"/"+$("#rango_inicio").val()+"/"+$("#rango_fin").val(), "_blank")
  myWindow.document.title = "PAGOS "+suministro;myWindow.focus();myWindow.print();ocultar_modal('rangos_pagos');
  } else { swal({title : '', text : '<b>ALERTA</b><br>DEBE SELECCIONAR UN PERIODO DE INICIO Y/O PERIODO FINAL PARA IMPRIMIR EL REPORTE',type: 'warning',html :true});}});
function anular_nota_credito(_nro,_oficod,_ofiagecod,_suministro){
  swal({title: "<b style='font-family:Ubuntu'>¿Esta seguro de anular la nota de crédito?</b>",text: "<span style='font-family:Ubuntu'>Si esta seguro, seleccione <b>'ACEPTAR'</b>; sino seleccione <b>'CANCELAR'</b>.</span>",type: "info",html: true, confirmButtonColor: "#00A65A",showCancelButton: true,closeOnConfirm: false,showLoaderOnConfirm: true},
  function(){$.ajax({type : 'POST',url : servidor + 'cuenta_corriente/eliminar_nc?ajax=true',data : ({ numero : _nro, oficod : _oficod, ofiagecod  : _ofiagecod,suministro : _suministro}), cache : false, dataType : 'json',
  success : function(data){ if(data.result){$("#autorizaciones").modal('hide');swal({title : "",text : data.mensaje,type : "success",html:true});setTimeout(function(){location.reload();},1000);} else { swal({ title : "",text : data.mensaje,type : "warning",html : true});}
  }, error :  function(jqXHR,textStatus,errorThrown){$("#autorizaciones").modal('hide');_error(jqXHR,textStatus,errorThrown);}});});}
function validar_segundo_pediodo(){ var min = $("#facturacion_periodos_inicio").val(); $("#facturacion_periodos_fin").attr('disabled',false); var minusage = parseInt(min); var select = $('#facturacion_periodos_fin'); select.val($('option:first', select).val());
    $("#facturacion_periodos_fin option").each(function(){ if(minusage >= parseInt($(this).val()) && parseInt($(this).val()) != -1) { $(this).attr('disabled','disabled');} else { $(this).attr('disabled',false);}});}
function visualizar_facturacion(){ 
  var suministro = $("#faturacion_suministro").val(); if($("#facturacion_total").is(":checked")){ window.open(servidor+"cuenta_corriente/facturacion/"+suministro+"/0/0", "_blank");
  } else { var inicio = $("#facturacion_periodos_inicio").val(); var fin = $("#facturacion_periodos_fin").val(); if(inicio == -1) { swal({ title : "", text : "<b>ALERTA</b><br>DEBE SELECCIONAR ALGÚN PERIODO", type : "warning", hmtl : true });}
  else if (inicio != -1 && fin == -1) { window.open(servidor+"cuenta_corriente/facturacion/"+suministro+"/"+inicio+"/0", "_blank"); } else {  window.open(servidor+"cuenta_corriente/facturacion/"+suministro+"/"+inicio+"/"+fin, "_blank"); }}
  $("#facturacion_suministro").modal("hide");$("#facturacion_periodos_fin").attr('disabled','disabled');$("#facturacion_total").attr('checked',false); }
function ver_notaCredito(_suministro,serie,nro) { var myWindow = window.open(servidor+"cuenta_corriente/notaCredito/"+_suministro+"/" + serie + "/"+nro, "_blank"); myWindow.focus(); myWindow.print();}


function ver_duplicado(){
	$("#cuerpo_tabla_duplicados").html("");
	$("#tabla_duplicados").hide();
	waitingDialog.show("Cargando Información...",{dialogSize: 'lg' , progressType: 'warning'});
	$.ajax({ 
	  	type : 'POST', 
	  	url  : servidor+'cuenta_corriente/get_pediodo_facturacion?ajax=true', 
	  	data : ({suministro : suministro}), 
	  	cache : false,
	  	dataType : 'json',
	  	success : function(resultado){
			waitingDialog.hide();
			if(resultado.result){
				var periodo1 =  resultado.fecha.slice(-4) + "-" + resultado.fecha.substr(3,2);
				var periodo =  resultado.fech.slice(-4) + "-" + resultado.fech.substr(3,2);
				var mes = parseInt(resultado.fech.substr(3,2));
				var anio = parseInt(resultado.fech.slice(-4));
				$("#periodo_inicio").empty();
				$("#periodo_inicio").append("<option value='-1'>Selecciones una opción </option>");
				while(periodo1 != periodo){
					if(mes < 13){ 
					$("#periodo_inicio").append("<option value='"+anio+"-"+((mes<10) ? "0"+mes : mes)+"'>"+anio+"-"+((mes < 10 ) ? "0"+mes : mes)+"</option>"); 
					periodo = anio+"-"+((mes < 10) ? "0"+mes : mes);
					mes++;
					} else {anio ++;mes = 1;}
				} 
				setTimeout(() => {
					$("#duplicado_recibo").modal({backdrop: 'static', keyboard: false, show : "show"});
				}, 500);
			} else {
				alertify.alert('<span class="text-yellow"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alerta</span>', '<strong>'+resultado.mensaje+'</strong>');    
			}
	  	}, error : function(jqXHR , textStatus, errorThrown){
			 _error(jqXHR , textStatus, errorThrown);
		}
	});
}


function generar_nota_autorizacion(_nro){
  waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
  $.ajax({ type : 'POST', url : servidor+'cuenta_corriente/get_autorizacion?ajax=true', data : ({ numero : _nro }), cache : false, dataType : 'json',
  success : function(data){ if(data.result){ waitingDialog.hide(); $("#autorizaciones").modal('hide'); window.open(servidor+"cuenta_corriente/generar_nota_credito/"+data.autorizacion['CLIUNICOD']+"/"+data.autorizacion['AUT_SER']+"/"+data.autorizacion['AUT_REC'], "_blank");
  } else { waitingDialog.hide(); $("#autorizaciones").modal('hide'); setTimeout(function(){ location.reload(); },500); }
  }, error :  function(jqXHR,textStatus,errorThrown){ _error(jqXHR,textStatus,errorThrown); } });}
function generar_nota(_suministro,_serie,_numero){  window.open(servidor+"cuenta_corriente/generar_nota_credito/"+_suministro+"/"+_serie+"/"+_numero, "_blank");}
function enviar_suministro(suministro){ 
  waitingDialog.show("Cargando Información...",{dialogSize:"lg",progressType:"warning"}); _url = servidor+"cuenta_corriente/consultar_cartera?ajax=true"; _data = ({suministro : suministro}); 
  $.ajax({ type: "POST", url: _url,  data: _data, dataType: "json", success: function(data){ if(data.result) {  waitingDialog.hide(); ocultar_modal('unidades');  window.open(servidor+"cuenta_corriente/mostrar_cartera/"+data.suministro, "_blank"); }
  else { waitingDialog.hide();  swal({'title' : "", 'text' : data.mensaje, 'type' : "warning", 'html' : true}); }
  }, error(jqXHR,textStatus,errorThrown){ _error(jqXHR,textStatus,errorThrown); } });}
  function consumos(suministro){
    waitingDialog.show("Cargando Información...",{dialogSize:"lg",progressType:"warning"});
    $.ajax({ 
        type: "POST", 
        url: servidor+"cuenta_corriente/consumos?ajax=true", 
        data: ({suministro : suministro1}),
        dataType: "json",
        success: function(data){
            if(data.result) {
                waitingDialog.hide(); 
                var categoria = new Array();
                var series = new Object();
                series.name = 'Consumos';
                var consumos = new Array();
                for(var i = 0; i < data.consumos.length; i++){
                    consumos.push(parseInt(data.consumos[i]['LECCONME']));
                    categoria.push(obtenerMes(data.consumos[i]['LECPERIO'].substr(4,2)) + "-" +data.consumos[i]['LECPERIO'].substr(0,4));
                  }
                series.data = consumos;
                graficar('grafico',categoria,series);
                $("#tabla_consumos").html(data.cuerpo);
                $("#consumos").modal({backdrop: 'static', keyboard: false, show : "show"});
            } else {
                waitingDialog.hide(); 
                swal({'title' : "", 'text' : data.mensaje, 'type' : "warning", 'html' : true});
            }
        }, error(jqXHR,textStatus,errorThrown){ 
            _error(jqXHR,textStatus,errorThrown);
        }
    });
}
function graficar(id, cat, consumos){
    var ancho = $(window).width();
    $('#'+id).highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: 'Consumos del usaurio'
        },
        subtitle: {
            text: 'SEDALIB S.A.'
        },
        xAxis: {
            categories: cat,
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Metros cúbicos (m<sup>3</sup> )'
            }
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                '<td style="padding:0"><b> {point.y:.0f} m<sup>3</sup> </b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0
            }
        },
        series: [consumos]
    });
}

function obtenerMes(str){
    switch(str){
        case '01' : return "ENE";
                    break;
        case '02' : return "FEB";
                    break;
        case '03' : return "MAR";
                    break;
        case '04' : return "ABR";
                    break;
        case '05' : return "MAY";
                    break;
        case '06' : return "JUN";
                    break;
        case '07' : return "JUL";
                    break;
        case '08' : return "AGO";
                    break;
        case '09' : return "SET";
                    break;
        case '10' : return "OCT";
                    break;
        case '11' : return "NOV";
                    break;
        case '12' : return "DIC";
                    break;
    }
}
function acciones_ejecutadas(suministro){ 
  waitingDialog.show("Cargando Información...",{dialogSize:'lg',progressType:'warning'});
  $.ajax({
      type: 'POST',
      url : servidor+'cuenta_corriente/acciones_ejecutadas?ajax=true',
      data: ({ suministro : suministro }), 
      cache : false, 
      dataType : 'json',
      success : function(resultado){ 
          if(resultado.result){
              waitingDialog.hide();
              var myWindow = window.open(servidor+"cuenta_corriente/listar_acciones_ejecutudas/"+ suministro, "_blank");
          } else {
              waitingDialog.hide();
              swal("", resultado.mensaje, "info"); 
          }
      } , error: function(jqXHR,textStatus,errorthrown){
          waitingDialog.hide();swal("", "Ocurrió un error en el Servidor, por favor comuniquese con soporte para resolverlo", "error");
      }
  })
}





function buscar_duplicado(){
  var periodo = $("#periodo_inicio").val();
    if(periodo != -1){
		$("#cuerpo_tabla_duplicados").html("");
		$("#tabla_duplicados").hide();
		$("#buscar_duplciado").show('slow');
		$.ajax({
			type: 'post',
			url : servidor+'cuenta_corriente/obtener_duplicado?ajax=true',
			data : ({
				suministro : suministro,
				periodo : periodo
			}),
			cache: false,
			dataType : 'json',
			success : function(data){
				$("#buscar_duplciado").hide('slow');
				if(data.result){
					$("#cuerpo_tabla_duplicados").html(data.recibo);
					$("#tabla_duplicados").show('slow');
				} else {
					alertify.alert('<span class="text-yellow"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alerta</span>', '<strong>'+data.mensaje+'</strong>');    
				}
			},
			error : function(jqXHR,textStatus,errorthrown){
				$("#buscar_duplciado").hide('slow');
				_error(jqXHR , textStatus, errorthrown);
			}
		});
    } else {
		alertify.alert('<span class="text-yellow"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alerta</span>', '<strong>Debe seleccionar un periodo.</strong>');    
    }
}
function imprimir_cuenta_corriente () { 
  var alto = $( window ).height();
  console.log(alto);
  var ancho = $( window ).width(); 
  var myWindow = window.open(servidor+"cuenta_corriente/imprimir_cuenta_corriente/" + suministro, "_blank", "toolbar=yes, scrollbars=yes, resizable=yes, top=0, left=0, width="+ancho+", height="+alto); 
  myWindow.focus();
  myWindow.print();
}
imprimir_acciones =  function(suministro){ waitingDialog.show("Cargando Información...",{dialogSize:'sm',progressType:'warning'})
  $.ajax({ type: 'POST', url : servidor+'cuenta_corriente/acciones_ejecutadas?ajax=true', data: ({ suministro : suministro }), cache : false, dataType : 'text',
    success : function(data){ resultado = JSON.parse(data);
      if(resultado.result ==  true){ waitingDialog.hide();let h = window.height; let w = screen.width; let myWindow = window.open(servidor+"cuenta_corriente/impirmir_lista_de_acciones/"+ suministro, "_blank", 'toolbar=no ,location=0, status=no,titlebar=no,menubar=no,width='+w +',height=' +h);
      } else { waitingDialog.hide(); swal("", resultado.mensaje, "info") }
    } , error: function(jqXHR,textStatus,errorthrown){ waitingDialog.hide(); swal("", "Ocurrió un error en el Servidor, por favor comuniquese con soporte para resolverlo", "error");}
  })}
  imprimir_acciones_detalladas =  function(suministro){ waitingDialog.show("Cargando Información...",{dialogSize:'sm',progressType:'warning'})
    $.ajax({ type: 'POST', url : servidor+'cuenta_corriente/acciones_ejecutadas?ajax=true', data: ({ suministro : suministro }), cache : false, dataType : 'text',
      success : function(data){ resultado = JSON.parse(data);
        if(resultado.result ==  true){ waitingDialog.hide();let h = window.height;let w = window.width; let myWindow = window.open(servidor+"cuenta_corriente/impirmir_lista_de_acciones_detalladas/"+ suministro, "_blank", 'toolbar=no ,location=0, status=no,titlebar=no,menubar=no,width='+w +',height=' +h);
      } else { waitingDialog.hide(); swal("", resultado.mensaje, "info"); }
    } , error: function(jqXHR,textStatus,errorthrown){waitingDialog.hide();swal("", "Ocurrió un error en el Servidor, por favor comuniquese con soporte para resolverlo", "error");}
    })}











function guardar_ampliacion (){ 
  swal({ title: "¿Estas seguro que quieres ampliar la Fecha de Vencimiento?", text: "", type: "warning", showCancelButton: true, closeOnConfirm: false, confirmButtonText: "SÍ!", confirmButtonColor: "#296fb7"
      }, function() {
          $.ajax({ type: "POST", url: servidor + "cuenta_corriente/ampliacion_recibo?ajax=true", data: { 'suministro' : suministro },
            success: function(data){ } })
           .done(function(data) { resultado = data;
              if(resultado.result == true){ swal("Generado!", "La ampliación se ha registrado con éxito", "success"); $("#ampliaciones_cortes").modal('hide');
                setTimeout(() => { $('.sidebar-mini').css("padding-right","0px") }, 500)
              } else { swal("OOps!",resultado.mensaje); }})
           .error(function(data) { swal("Oops", "We couldn't connect to the server!", "error"); });
      })}

      
restaFechas = function(f1,f2) {let aFecha1 = f1.split('/');let aFecha2 = f2.split('/');let fFecha1 = Date.UTC(aFecha1[2],aFecha1[1]-1,aFecha1[0]);let fFecha2 = Date.UTC(aFecha2[2],aFecha2[1]-1,aFecha2[0]);let dif = fFecha2 - fFecha1;let dias = Math.floor(dif / (1000 * 60 * 60 * 24));return dias;}
colocar_fecha =  function(){ let valor  = parseInt(fecha_final.substr(0,2)); let date = new Date(); let primerDia = new Date(date.getFullYear(), date.getMonth(), 1); let ultimoDia = new Date(date.getFullYear(), date.getMonth() + 1, 0); let restar = ultimoDia.getDate()  - date.getDate(); let inicio = valor - date.getDate(); dias = "+"+(inicio+1)+"d";
  $("#fecha_plazo").datepicker({ language: 'es', autoclose: true,startDate: dias, endDate: '+'+restar+'d'}).datepicker("show");
}




function enviar_suministro(suministro){ 
  waitingDialog.show("Cargando Información...",{dialogSize:"lg",progressType:"warning"});
  _url = servidor+"cuenta_corriente/consultar_cartera?ajax=true";
  _data = ({suministro : suministro}); 
  $.ajax({ 
    type: "POST", 
    url: _url, 
    data: _data,
    dataType: "json",
      success: function(data){
        if(data.result) { 
          waitingDialog.hide(); 
          $("#unidades").modal('hide');
          ocultar_modal('unidades')
          var myWindow = window.open(servidor+"cuenta_corriente/mostrar_cartera/"+data.suministro, "_blank");
        }
        else { 
          waitingDialog.hide(); 
          swal({'title' : "¡Lo sentimos!", 'text' : data.mensaje, 'type' : "warning", 'html' : true});
        }
      }, error(jqXHR,textStatus,errorThrown){ 
          _error(jqXHR,textStatus,errorThrown);
         }
      })
}

  
//let duplicado = (fecha) => {let periodo =  fecha.substr(6,4)+fecha.substr(3,2); let myWindow = window.open(servidor+"facturacion/creo_recibo/"+suministro+"/" + periodo, "_blank", "toolbar=yes, scrollbars=yes, resizable=yes, top=50, left=80, width=1100, height=800"); myWindow.focus(); myWindow.print();}

let consultar_convenios = () => {let myWindow = window.open(servidor+"cuenta_corriente/consultar_convenio/"+suministro, "_blank", "toolbar=yes, scrollbars=yes, resizable=yes, top=50, left=80, width=1100, height=800");}



/*siac en genesys */
function obtener_informacion_siac(){
    waitingDialog.show("Cargando Información del sistema SIAC...",{dialogSize:"lg",progressType:"warning"});
    $.ajax({ 
      type: "POST", 
      url: servidor+"cuenta_corriente/siac?ajax=true", 
      data: ({
        suministro : suministro
      }),
      dataType: "json",
        success: function(data){
          waitingDialog.hide(); 
          if(data.result) { 
            if(data.lecturas != ''){
              $("#lecturas_realizadas").dataTable().fnDestroy();
              $("#tabla_lecturas").show();
              $("#cuerpo_lecturas_realzidas").html("");
              $("#cuerpo_lecturas_realzidas").html(data.lecturas);
              $('#lecturas_realizadas').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[5, 10, 15, 20, -1],[5, 10, 15, 20, "Todos"]]});
            } else {
              $("#tabla_lecturas").html("");
              $("#tabla_lecturas").html("El suministro no cuenta con lecturas registradas por el momento");
            }
            if(data.relecturas != ''){
              $("#relecturas_realizadas").dataTable().fnDestroy();
              $("#tabla_relecturas").show();
              $("#cuerpo_relecturas_realzidas").html("");
              $("#cuerpo_relecturas_realzidas").html(data.relecturas);
              $('#relecturas_realizadas').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[5, 10, 15, 20, -1],[5, 10, 15, 20, "Todos"]]});
            } else {
              $("#tabla_relecturas").html("");
              $("#tabla_relecturas").html("El suministro no cuenta con relecturas registradas por el momento");
            }
            if(data.notificacion != ''){
              $("#notificacion_realizadas").dataTable().fnDestroy();
              $("#tabla_notificacion").show();
              $("#cuerpo_notificacion_realzidas").html("");
              $("#cuerpo_notificacion_realzidas").html(data.notificacion);
              $('#notificacion_realizadas').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[5, 10, 15, 20, -1],[5, 10, 15, 20, "Todos"]]});
            } else {
              $("#tabla_notificacion").html("");
              $("#tabla_notificacion").html("El suministro no cuenta con notificaciones registradas por el momento");
            }
            if(data.inspeccionInterna != ''){
              $("#inspeccion_interna_realizadas").dataTable().fnDestroy();
              $("#tabla_inspeccion_interna").show();
              $("#cuerpo_inspeccion_interna_realzidas").html("");
              $("#cuerpo_inspeccion_interna_realzidas").html(data.inspeccionInterna);
              $('#inspeccion_interna_realizadas').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[5, 10, 15, 20, -1],[5, 10, 15, 20, "Todos"]]});
            } else {
              $("#tabla_inspeccion_interna").html("");
              $("#tabla_inspeccion_interna").html("El suministro no cuenta con inspecciones internas registradas por el momento");
            }
            if(data.isnpeccionExterna != ''){
              $("#inspeccion_externa_realizadas").dataTable().fnDestroy();
              $("#tabla_inspeccion_externa").show();
              $("#cuerpo_inspeccion_externa_realzidas").html("");
              $("#cuerpo_inspeccion_externa_realzidas").html(data.isnpeccionExterna);
              $('#inspeccion_externa_realizadas').DataTable({ bInfo: false,"ordering": false,"lengthMenu": [[5, 10, 15, 20, -1],[5, 10, 15, 20, "Todos"]]});
            } else {
              $("#tabla_inspeccion_externa").html("");
              $("#tabla_inspeccion_externa").html("El suministro no cuenta con inspecciones externas registradas por el momento");
            }
            $("#datos_externos").show('slow')
          }
          else { 
            swal({'title' : "", 'text' : data.mensaje, 'type' : "warning", 'html' : true});
          }
        }, error(jqXHR,textStatus,errorThrown){ 
            _error(jqXHR,textStatus,errorThrown);
           }
      });
  }
  
  function cerrar_siac(){
    $("#datos_externos").hide('slow')
    $("#cuerpo_lecturas_realzidas").html("");
  }
  
  function ver_imagen_lectura(_ruta, _lectura, _fecha){
    $("#metros_cubicos_lectura").html(_lectura);
    $("#fecha_lectura").html(_fecha);
    $("#imagen_lectura_1").attr('src',"http://150.10.9.60/siac/"+_ruta)
    $("#imagen_lectura").modal('show')
  }
  
  function ver_imagen_opcional_lectura(_ruta, _lectura, _fecha){
    $("#metros_cubicos_lectura_opcional").html(_lectura);
    $("#fecha_lectura_opcional").html(_fecha);
    $("#imagen_opcional_lectura_1").attr('src',"http://150.10.9.60/siac/"+_ruta)
    $("#imagen_opcional_lectura").modal('show')
  }
  
  function ver_imagen_obs_lectura(_obs, _ruta){
    $("#observacion_lectura").html(_obs);
    $("#imagen_observacion_lectura_1").attr('src',"http://150.10.9.60/siac/"+_ruta)
    $("#imagen_observacion_lectura").modal('show')
  }
  
  function ver_imagen_relectura(_ruta, _lectura, _fecha){
    $("#metros_cubicos_relectura").html(_lectura);
    $("#fecha_relectura").html(_fecha);
    $("#imagen_relectura_1").attr('src',"http://150.10.9.60/siac/"+_ruta)
    $("#imagen_relectura").modal('show')
  }
  
  function ver_imagen_opcional_relectura(_ruta, _lectura, _fecha){
    $("#metros_cubicos_relectura_opcional").html(_lectura);
    $("#fecha_relectura_opcional").html(_fecha);
    $("#imagen_opcional_relectura_1").attr('src',"http://150.10.9.60/siac/"+_ruta)
    $("#imagen_opcional_relectura").modal('show')
  }
  
  function ver_imagen_obs_relectura(_obs, _ruta){
    $("#observacion_relectura").html(_obs);
    $("#imagen_observacion_relectura_1").attr('src',"http://150.10.9.60/siac/"+_ruta)
    $("#imagen_observacion_relectura").modal('show')
  }
  
  function ver_foto_notificacion(_ruta){
    $("#imagen_notificacion_1").attr('src',"http://150.10.9.60/siac/"+_ruta);
    $("#imagen_notificacion").modal('show');
  }
  
  function ver_foto_opcional_notificacion(_ruta){
    $("#imagen_opcional_notificacion_1").attr('src',"http://150.10.9.60/siac/"+_ruta);
    $("#imagen_opcional_notificacion").modal('show');
  }
  
  function ver_foto_inspeccion(_ruta){
    $("#imagen_inspeccion_1").attr('src',"http://150.10.9.60/siac/"+_ruta);
    $("#imagen_inspeccion").modal('show');
  }
  
  function ver_foto_ficha_notificacion(_ruta){
    var d=new Date();
    var n=d.getTime();
    var k = _ruta;
    var extension = k.split("."); 
    if(extension.length>=2){
      var num = extension.length-1;
      if(extension[num] === "tif" ||extension[num] === "TIF"){
        location.href = 'http://150.10.9.60/siac/'+k;
      }else{
        var anch=window.screen.width;
        var alt=window.screen.height;
        var altura=parseInt(alt-150);
        var anchura=parseInt(anch-766);
        var y=0;
        var x=parseInt(parseInt(anch/2)-parseInt((anch-766)/2));
        window.open("http://150.10.9.60/siac/"+k+'?'+n, "_blank", "toolbar=yes, scrollbars=yes, resizable=yes, top="+y+", left="+x+", width="+anchura+", height="+altura);
      }
    }
  }
/** end siac en Genesys */