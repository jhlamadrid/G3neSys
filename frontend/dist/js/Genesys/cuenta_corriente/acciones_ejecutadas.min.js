var data = new Array();
$('#deuda_corte').DataTable({bFilter: true, bInfo: false,"ordering": false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]],});
$(document).ready(function() { 
  	var table = $('#resumen').DataTable({bFilter: true, bInfo: false,"ordering": false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]],});
  	$('#resumen tbody').on('click', 'tr', function () { $('#resumen > tbody  > tr').each(function() { this.style.background = "#fff"; });
  	data = table.row( this ).data(); this.style.background ="rgba(0, 141, 76, 0.47)"; });
});
var waitingDialog = waitingDialog || (function ($) { 'use strict';
var $dialog = $('<div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;"><div class="modal-dialog modal-m"><div class="modal-content" style="border-radius:5px">' +
  '<div class="modal-header"><h3 style="margin:0;font-family:\'Ubuntu\'"></h3></div><div class="modal-body"><div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div></div></div></div></div>');
return { show: function (message, options) { if (typeof options === 'undefined') options = {}; if (typeof message === 'undefined') message = 'Cargando Recibos'; var settings = $.extend({ dialogSize: 'm', progressType: '', onHide: null  }, options);$dialog.find('.modal-dialog').attr('class', 'modal-dialog').addClass('modal-' + settings.dialogSize);$dialog.find('.progress-bar').attr('class', 'progress-bar');
  if (settings.progressType) $dialog.find('.progress-bar').addClass('progress-bar-' + settings.progressType); $dialog.find('h3').text(message);
  if (typeof settings.onHide === 'function') { $dialog.off('hidden.bs.modal').on('hidden.bs.modal', function (e) { settings.onHide.call($dialog); }); } $dialog.modal();},hide: function () { $dialog.modal('hide'); }
};})(jQuery);
function _error(jqXHR,textStatus,errorThrown){
	waitingDialog.hide();
    if (jqXHR.status === 0 && textStatus !== 'parsererror')  alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>Verifique su conexión a Internet. No se ha podido conectar con el Servidor.</strong>');
    else if (jqXHR.status == 404) alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>El recurso solicitado no se puede encontrar, pero puede estar disponible en el futuro</strong>'); 
    else if (jqXHR.status == 500) alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>Error interno en el servidor, por favor recargue la página o intente en unos minutos.</strong>');  
	else if (jqXHR.status == 303) location.assign(servidor);
	else if (textStatus === 'parsererror') alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>Hubo un error en el servidor, el recurso solicitado tiene unos pequeños problemas, por favor recarge la página.</strong>');
    else if (textStatus === 'timeout') alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>Error en el tiempo de ejecución.</strong>'); 
    else if (textStatus === 'abort') alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>La petición fue abortada.</strong>');  
    else alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>Error desconocido '+jqXHR.responseText+' .</strong>'); 
}
function ver_detalle_deuda (suministro){
  	if( data.length > 0){ 
		waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
		ofi = data[0]; 
		age = data[1]; 
		num = data[2];
    	$.ajax({ 
			type: 'POST', 
			url : servidor+'cuenta_corriente/ver_deuda_corte?ajax=true', 
			data: ({ ofi : ofi, age : age, num : num, suministro : suministro }), 
			cache: false,
			dataType: 'json',
      		success: function(data){
				waitingDialog.hide();
        		if(data.result){ 
					$("#deuda_corte").dataTable().fnDestroy(); 
					$("#cuerpo_deuda").empty(); 
					$("#cuerpo_deuda").append(data.cuerpo);
					$('#deuda_corte').DataTable({bFilter: true, bInfo: false,"ordering": false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]],}); 
					$("#cantidad_recibos").val(data.RECIBOS.length); 
					$("#saldo_corte").val(data.saldo); 
					$("#modal_deuda").modal("show");
        		} else {
					alertify
					.alert(`<span class='colorWarning'><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> &nbsp; ALERTA</span>`,"<b>"+data.mensaje+"<b>"); 
					$("#deuda_detallada").fadeOut("slow");
				}
      		}, error : function(jqHRX, textStatus, errorThrown){ 
				_error(jqHRX, textStatus, errorThrown)
			} 
		});
  	} else { 
    	alertify
    	.alert(`<span class='colorWarning'><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> &nbsp; ALERTA</span>`,"<b>Debe seleccionar algún corte para ver el detalle de la deuda por la cual se genero dicho orden de corte.<b>");
   	}
}
imprimir_acciones =  function(suministro){ var width = window.innerWidth; var height = window.innerHeight;  var myWindow = window.open(servidor+"cuenta_corriente/acciones/impimir_acciones/" + suministro, "_blank", "toolbar=yes, scrollbars=yes, resizable=yes, top=0, left=0, width="+width+", height="+height);myWindow.focus();myWindow.print();}
function ver_mas_acciones (suministro){
	waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
  	$.ajax({ 
		type: 'POST', 
		url : servidor+'cuenta_corriente/ver_otra_deuda_corte?ajax=true', 
		data: ({ suministro : suministro }), 
		cache: false, 
		dataType: 'json',
    	success: function(data){
			waitingDialog.hide();
			if(data.result){ 
				$("#otros_cortes_cuerpo").dataTable().fnDestroy(); 
				$("#otros_cuerpo").empty();
				$("#otros_cuerpo").append(data.cuerpo);				
				$('#otros_cortes_cuerpo').DataTable({bFilter: true, bInfo: false,"ordering": false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]],});
				$("#otras_acciones").modal('show')
			} else { 
				alertify
				.alert(`<span class='colorWarning'><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> &nbsp; ALERTA</span>`,"<b>"+data.mensaje+"<b>"); 
			}
    	}, error : function(jqHRX,textStatus, errorThrown){ 
			_error(jqHRX, textStatus, errorThrown)
		}
	});
}
function ver_detalle(serie,numero,suministro){
	waitingDialog.show('Cargando Información...', {dialogSize: 'lg', progressType: 'warning'});
    $.ajax({ 
      type : "POST",
      url : servidor+"cuenta_corriente/obtener_detalle_recibo?ajax=true", 
      data : ({ 
        suministro : suministro, 
        serie : serie,
        numero : numero
      }),
      cache : false, 
      dataType  : 'json',
      success : function(resultado){ 
        waitingDialog.hide();
        if(resultado.result){
          $("#cabecera_detalle_recibo").empty();
          $("#serie_numero_recibo").empty();
          $("#cuerpo_detalle_recibo").empty();
          $("#cuerpo_detalle_recibo").append(resultado.cuerpo);
          $("#serie_numero_recibo").append(resultado.ser_nro);
          $("#cabecera_detalle_recibo").append(resultado.cabecera);
          $("#detalle_recibo").modal({backdrop: 'static', keyboard: false, show:"show"});
        } else { 
          swal({title : "",text : resultado.mensaje, type: "warning",html :true}) 
        }
      }, error : function(jqXHR,textStatus,errorThrown){ 
        _error(jqXHR,textStatus,errorThrown)
      }
    })
}
