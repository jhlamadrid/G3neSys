$( document ).ready(function() { $("#btn_busqueda_m").attr('disabled',false); $("#btn_busqueda_r").attr('disabled',false); $("#campo_busqueda").attr('disabled',false); $("#btn_buscar").attr('disabled',false); });
$("#clientes").DataTable({ bFilter: false,bSort:false, bInfo: false,responsive: true,lengthMenu: [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]] });
function limitar(e, contenido, caracteres){ var unicode=e.keyCode? e.keyCode : e.charCode;
    if(unicode==8 || unicode==46 || unicode==13 || unicode==9 || unicode==37 || unicode==39 || unicode==38 || unicode==40) return true;
    if(contenido.length>=caracteres){ document.getElementById("numero").focus(); return false; }
    return true;}
function enviar_suministro(suministro){ 
    waitingDialog.show("Cargando Información...",{dialogSize:"lg",progressType:"warning"}); _url = servidor+"cuenta_corriente/consultar_cartera?ajax=true"; _data = ({suministro : suministro}); 
  	$.ajax({ type: "POST", url: _url, data: _data, dataType: "json",
      success: function(data){waitingDialog.hide(); 
        if(data.result) window.location.href = servidor+"cuenta_corriente/mostrar_cartera/"+data.suministro; 
        else swal({'title' : "", 'text' : data.mensaje, 'type' : "warning", 'html' : true});
      }, error(jqXHR,textStatus,errorThrown){ _error(jqXHR,textStatus,errorThrown);}});}
$("#btn_busqueda_r").click(function(){ $("#buscar_recibo").modal({backdrop: 'static', keyboard: false, show:"show"}); $("#serie").val(""); $("#numero").val(""); });
function buscar_persona(){
  var serie = $("#serie").val();
  var numero = $("#numero").val();
  if(serie.trim() != "" && numero.trim() != ""){
    waitingDialog.show("Buscando...", {dialogSize: "lg", progressType: "warning"});
    $.ajax({
      type : "POST",
      url : servidor+"cuenta_corriente/buscar_cliente?ajax=true",
      data : ({
        serie : serie,
        numero :  numero
      }),
      cache : false,
      dataType : "json",
      success :  function(data){
        waitingDialog.hide();
        if(data.result){
          $("#buscar_recibo").modal("hide");
          $("#clientes").dataTable().fnDestroy();
          $("#cuerpo_cliente").empty();
          $("#cuerpo_cliente").append(data.cliente);
          $("#clientes").DataTable({bFilter: false, bInfo: false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]});
        } else {
          alertify.alert('<span class="text-yellow"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alerta</span>', '<strong>'+data.mensaje+'</strong>');
        }
      }, error :  function (jqXHR,textStatus,errorThrown){
        _error(jqXHR,textStatus,errorThrown)
      }
    })
  } else {
    if(serie.trim() == "" && numero.trim() == ""){
      alertify.alert('<span class="text-yellow"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alerta</span>', '<strong>Debe rellenar la serie y el número del recibo, para realizar la búsqueda.</strong>');
    } else if(serie.trim() == "" ){
      alertify.alert('<span class="text-yellow"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alerta</span>', '<strong>Debe rellenar la serie del recibo, para realizar la búsqueda.</strong>');
    } else if (numero.trim() == ""){
      alertify.alert('<span class="text-yellow"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alerta</span>', '<strong>Debe rellenar el número del recibo, para realizar la búsqueda.</strong>');
    }
  }
}
function cambiar_tipo(){
      _select = $("#tipo_busqueda").val();
      $("#campo_busqueda").val("");
      if(_select == 'nombre') {
        $("#campo_busqueda").attr('type','text');
        $("#campo_busqueda").attr('onKeyUp','');
        $("#campo_busqueda").attr('onKeyDown','');
        $("#campo_busqueda").attr('placeholder','Ejm: Guevara');
        $("#referencia_busqueda").html("Ingrese el apellido del cliente")
      } else if(_select == "direccion"){
        $("#campo_busqueda").attr('type','text');
        $("#campo_busqueda").attr('onKeyUp','');
        $("#campo_busqueda").attr('onKeyDown','');
        $("#campo_busqueda").attr('placeholder','Ejm: Mansiche');
        $("#referencia_busqueda").html("Ingrese el nombre de calle del cliente")
      } else if(_select == "ruc"){
        $("#campo_busqueda").attr('type','number');
        $("#campo_busqueda").attr('onKeyUp','return limitar(event,this.value,11)');
        $("#campo_busqueda").attr('onKeyDown','return limitar(event,this.value,11)');
        $("#campo_busqueda").attr('placeholder','Ejm: 10700678861');
        $("#referencia_busqueda").html("Ingrese el R.U.C. del cliente")
      } else if(_select == 'dni'){
        $("#campo_busqueda").attr('type','number');
        $("#campo_busqueda").attr('onKeyUp','return limitar(event,this.value,8)');
        $("#campo_busqueda").attr('onKeyDown','return limitar(event,this.value,8)');
        $("#campo_busqueda").attr('placeholder','Ejm: 70067886');
        $("#referencia_busqueda").html("Ingrese el D.N.I. del cliente")
      } else { 
        $("#campo_busqueda").attr('type','number');
        $("#campo_busqueda").attr('onKeyUp','return limitar(event,this.value,11)');
        $("#campo_busqueda").attr('onKeyDown','return limitar(event,this.value,11)');
        $("#campo_busqueda").attr('placeholder','Ejm: 01016304160');
        $("#referencia_busqueda").html("Ingrese un suministro")
      }
    }
    function _error(jqXHR,textStatus,errorThrown){
      waitingDialog.hide(); 
      if (jqXHR.status === 0)  
        alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>Verifique su conexión a internet, o verifique su sesión de usuario.</strong>');
      else if (jqXHR.status == 404) 
        alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>El recursos solicitado no se puede encontrar, pero puede estar disponible en el futuro.</strong>');
      else if (jqXHR.status == 500) 
        alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>Ocurrió un error interno en el servidor, comuniquese con soporte del sistema.</strong>');
      else if (textStatus === 'parsererror')
        alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>Hubo un error interno, intente en unos minutos.</strong>');
      else if (textStatus === 'timeout')
        alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>El tiempo de conexión ha finalizado.</strong>');
      else if (textStatus === 'abort') 
        alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>El recurso solicitado ha sido cancelado.</strong>');
      else 
        alertify.alert('<span class="text-red"><i class="fa fa-times-circle" aria-hidden="true"></i> Error</span>', '<strong>Error desconocido: '+jqXHR.responseText+'.</strong>');
    }
var waitingDialog = waitingDialog || (function ($) { 'use strict';
  var $dialog = $('<div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;"><div class="modal-dialog modal-m"><div class="modal-content" style="border-radius:5px">' +
    '<div class="modal-header"><h3 style="margin:0;font-family:\'Ubuntu\'"></h3></div><div class="modal-body"><div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div></div></div></div></div>');
  return { show: function (message, options) { if (typeof options === 'undefined') options = {}; if (typeof message === 'undefined') message = 'Cargando Recibos'; var settings = $.extend({ dialogSize: 'm', progressType: '', onHide: null  }, options);$dialog.find('.modal-dialog').attr('class', 'modal-dialog').addClass('modal-' + settings.dialogSize);$dialog.find('.progress-bar').attr('class', 'progress-bar');
    if (settings.progressType) $dialog.find('.progress-bar').addClass('progress-bar-' + settings.progressType); $dialog.find('h3').text(message);
    if (typeof settings.onHide === 'function') { $dialog.off('hidden.bs.modal').on('hidden.bs.modal', function (e) { settings.onHide.call($dialog); }); } $dialog.modal();},hide: function () { $dialog.modal('hide'); }
  };})(jQuery);
$("#btn_busqueda_m").click(function(){ $("#busqueda_multiple").modal({backdrop: 'static', keyboard: false, show:"show"}); $("#urbanizacion").val(""); $("#direccion").val(""); $("#numero2").val(""); $("#nombre_cliente").val(""); });  
$("#buscar_combinado").click(function(){
  var u = $("#urbanizacion").val();
  var d = $("#direccion").val();
  var n = $("#numero2").val();
  var ot = $("#nombre_cliente").val();
  if(u.trim() != "" || d.trim() != "" || n.trim() != "" || ot.trim() != ""){
    waitingDialog.show("Buscando cuenta corriente...", {dialogSize: "lg", progressType: "warning"});
    $.ajax({
      type : "POST",
      url : servidor + 'cuenta_corriente/busqueda_multiple?ajax=true',
      data: ({
        u : u.toUpperCase(),
        d : d.toUpperCase(),
        n : n.toUpperCase(),
        ot : ot.toUpperCase()
      }),
      cache :  false,
      dataType : 'json',
      success :  function(data){
        waitingDialog.hide();
        if(data.result){
          $("#busqueda_multiple").modal("hide");
          $("#clientes").dataTable().fnDestroy();
          $("#cuerpo_cliente").empty();
          $("#cuerpo_cliente").append(data.cliente);
          $("#clientes").DataTable({bFilter: false, bInfo: false,"lengthMenu": [[10, 20, 50, 100, -1],[10, 20, 50, 100, "Todos"]]});
        } else {
          alertify.alert('<span class="text-yellow"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alerta</span>', '<strong>'+data.mensaje+'</strong>');
        }
      }, error :  function(jqXHR,textStatus,errorThrown){
        _error(jqXHR,textStatus,errorThrown)
      }
    })
  } else {
    alertify.alert('<span class="text-yellow"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alerta</span>', '<strong>Debe rellenar uno de los 4 campos que se muestran.</strong>');
  }
})
